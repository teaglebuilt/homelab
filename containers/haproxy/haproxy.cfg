global
    log stdout format raw local0
    maxconn 4096

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    option  forwardfor
    timeout connect 5s
    timeout client  30s
    timeout server  30s

frontend http_front
    bind *:80
    default_backend homepage_back

    acl host_portainer hdr(host) -i portainer.local
    acl host_homepage  hdr(host) -i homepage.local
    acl host_grafana   hdr(host) -i grafana.local
    acl host_graylog   hdr(host) -i graylog.local
    acl host_searxng   hdr(host) -i searxng.local
    acl host_paperless hdr(host) -i paperless.local
    acl host_opensearch hdr(host) -i opensearch.local
    acl host_chronograf hdr(host) -i chronograf.local
    acl host_influxdb  hdr(host) -i influxdb.local

    use_backend portainer_back   if host_portainer
    use_backend homepage_back    if host_homepage
    use_backend grafana_back     if host_grafana
    use_backend graylog_back     if host_graylog
    use_backend searxng_back     if host_searxng
    use_backend paperless_back   if host_paperless
    use_backend opensearch_back  if host_opensearch
    use_backend chronograf_back  if host_chronograf
    use_backend influxdb_back    if host_influxdb

listen stats
    bind *:8404
    stats enable
    stats uri /
    stats refresh 10s

backend portainer_back
    server portainer portainer:9000 check

backend homepage_back
    server homepage homepage:3000 check

backend grafana_back
    server grafana grafana:3000 check

backend graylog_back
    server graylog graylog:9001 check

backend searxng_back
    server searxng searxng:8080 check

backend paperless_back
    server paperless paperless-ai:3003 check

backend opensearch_back
    server opensearch opensearch-dashboards:5601 check

backend chronograf_back
    server chronograf chronograf:8888 check

backend influxdb_back
    server influxdb influxdb:8086 check
